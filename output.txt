The administrator investigated repeated PHP fatal errors in the Nextcloud Apache error log related to memcache configuration. The errors indicated that the Redis and APCu memcache modules (OC\Memcache\Redis and OC\Memcache\APCu) were either missing, not installed, or not enabled in PHP, causing fatal exceptions and class redeclaration conflicts. The Nextcloud config.php was confirmed to reference Redis for locking and local memcache, but PHP modules for Redis and APCu were present in the systemâ€™s PHP conf.d directory. Attempts to switch memcache.local to APCu and then to ArrayCache in config.php still resulted in HTTP 500 errors and persistent memcache-related fatal errors. Additional issues included denied access to /var/www/nextcloud/data/.ncdata and a missing script /var/www/nextcloud/php_redis_check.php. Overall, the root cause is misconfigured or conflicting PHP memcache modules causing Nextcloud caching failures and fatal errors.

---[recent tail]---
/nextcloud.local-error.log
[summary]
- The Nextcloud config.php file has no syntax errors.
- Line 40 of config.php sets 'memcache.local' to 'OCMemcacheArrayCache'.
- Apache error log shows multiple PHP fatal errors related to memcache:
  - "Memcache OC\Memcache\Redis not available for local cache" indicating missing or disabled PHP Redis module.
  - "Memcache OC\Memcache\APCu not available for local cache" indicating missing or disabled PHP APCu module.
  - Several "Cannot declare class OC\Memcache\APCu, because the name is already in use" errors.
  - "Memcache OCMemcacheAPCu not available for local cache" errors.
- There is also a client denied error accessing /var/www/nextcloud/data/.ncdata.
- A missing script error for '/var/www/nextcloud/php_redis_check.php' was logged. 

Summary: Nextcloud is configured to use memcache but PHP modules for Redis and APCu are either not installed, not enabled, or causing class redeclaration conflicts, resulting in fatal errors.
---[recent tail]---
che OCMemcacheAPCu not available for local cache (Is the matching PHP module installed and enabled?)\n\n  thrown in /var/www/nextcloud/lib/private/Memcache/Factory.php on line 81
[Thu Aug 28 13:45:59.168640 2025] [php:error] [pid 10577] [client 192.168.56.1:50178] PHP Fatal error:  Uncaught OCP\\HintException: [0]: Memcache OCMemcacheAPCu not available for local cache (Is the matching PHP module installed and enabled?)\n\n  thrown in /var/www/nextcloud/lib/private/Memcache/Factory.php on line 81

$ sed -ri -e "s|('memcache\.local'[[:space:]]*=>)[[:space:]]*'[^']*'|\1 '\\OC\\Memcache\\ArrayCache'|" -e "s|('memcache\.locking'[[:space:]]*=>)[[:space:]]*'[^']*'|\1 '\\OC\\Memcache\\ArrayCache'|" /var/www/nextcloud/config/config.php


$ grep -nE "memcache\.(local|locking|distributed)" /var/www/nextcloud/config/config.php
40:  'memcache.local' => 'OCMemcacheArrayCache',

$ sed -ri 's|('\''memcache\.local'\''[[:space:]]*=>)[[:space:]]*'[^']*'|\1 '\''\OC\Memcache\ArrayCache'\''|; s|('\''memcache\.locking'\''[[:space:]]*=>)[[:space:]]*'[^']*'|\1 '\''\OC\Memcache\ArrayCache'\''|; s|('\''memcache\.distributed'\''[[:space:]]*=>)[[:space:]]*'[^']*'|\1 '\''\OC\Memcache\ArrayCache'\''|' /var/www/nextcloud/config/config.php
sed: -e expression #1, char 51: unterminated `s' command
1: command not found
1: command not found
1: command not found

$ sed -ri "s|('memcache\.local'[[:space:]]*=>)[[:space:]]*'[^']*'|\1 '\\OC\\Memcache\\ArrayCache'|; s|('memcache\.locking'[[:space:]]*=>)[[:space:]]*'[^']*'|\1 '\\OC\\Memcache\\ArrayCache'|; s|('memcache\.distributed'[[:space:]]*=>)[[:space:]]*'[^']*'|\1 '\\OC\\Memcache\\ArrayCache'|" /var/www/nextcloud/config/config.php


$ sed -ri "s|'OCMemcacheArrayCache'|'\OC\Memcache\ArrayCache'|g" /var/www/nextcloud/config/config.php


$ grep -nE "memcache\.(local|locking|distributed)|APCu|Redis|ArrayCache" /var/www/nextcloud/config/config.php
40:  'memcache.local' => 'OCMemcacheArrayCache',

$ perl -0777 -pe 's/\x27OCMemcacheArrayCache\x27/\x27\\OC\\Memcache\\ArrayCache\x27/g' -i /var/www/nextcloud/config/config.php


$ curl -s -o /dev/null -w "%{http_code}\n" -H 'Host: nextcloud.local' http://127.0.0.1/
302

$ curl -s -o /dev/null -w "%{http_code}\n" -H 'Host: nextcloud.local' -L http://127.0.0.1/
200
